var j=Object.defineProperty;var U=(u,o,e)=>o in u?j(u,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[o]=e;var l=(u,o,e)=>U(u,typeof o!="symbol"?o+"":o,e);import{d as G,r as y,o as w,c as f,a as v,b as t,e as P,w as I,v as q,f as x,F as D,g as $,n as M,t as m,h as L,i as R,j as k,k as J,l as z}from"./vendor-7bMduS8h.js";import{P as S}from"./phaser-0RJB29YE.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}})();class F{constructor(){l(this,"dbName","AvoidObjectsGame");l(this,"version",1);l(this,"storeName","scores")}async openDB(){return new Promise((o,e)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>e(s.error),s.onsuccess=()=>o(s.result),s.onupgradeneeded=a=>{const n=a.target.result;if(!n.objectStoreNames.contains(this.storeName)){const r=n.createObjectStore(this.storeName,{keyPath:"id",autoIncrement:!0});r.createIndex("score","score",{unique:!1}),r.createIndex("playerName","playerName",{unique:!1}),r.createIndex("date","date",{unique:!1})}}})}async saveScore(o){const e=await this.openDB();return new Promise((s,a)=>{const r=e.transaction([this.storeName],"readwrite").objectStore(this.storeName),p={...o,date:new Date};console.log("Saving score to database:",p);const i=r.add({...p});i.onerror=()=>{console.error("Error saving score:",i.error),a(i.error)},i.onsuccess=()=>{console.log("Score saved successfully with ID:",i.result),s(i.result)}})}async getTopScores(o=10){const e=await this.openDB();return new Promise((s,a)=>{const i=e.transaction([this.storeName],"readonly").objectStore(this.storeName).index("score").openCursor(null,"prev"),g=[];let c=0;i.onerror=()=>{console.error("Error getting top scores:",i.error),a(i.error)},i.onsuccess=d=>{const h=d.target.result;h&&c<o?(g.push(h.value),c++,h.continue()):(console.log("Retrieved top scores:",g),s(g))}})}async getAllScores(){const o=await this.openDB();return new Promise((e,s)=>{const r=o.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();r.onerror=()=>s(r.error),r.onsuccess=()=>e(r.result)})}async clearAllScores(){const o=await this.openDB();return new Promise((e,s)=>{const r=o.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();r.onerror=()=>s(r.error),r.onsuccess=()=>e()})}}const O=new F,K={class:"start-screen"},W={class:"container"},H={class:"form-section"},V={class:"input-group"},X=["disabled"],Y={key:0,class:"leaderboard"},Q={class:"scores-list"},Z={class:"rank"},ee={class:"name"},se={class:"points"},te={class:"time"},ae=G({__name:"StartScreen",emits:["startGame"],setup(u,{emit:o}){const e=o,s=y(""),a=y([]),n=()=>{s.value.trim()&&e("startGame",s.value.trim())},r=async()=>{try{a.value=await O.getTopScores(5)}catch(p){console.error("Error loading top scores:",p)}};return w(()=>{r()}),(p,i)=>(v(),f("div",K,[t("div",W,[i[3]||(i[3]=t("div",{class:"header"},[t("h1",{class:"title"},"üéÆ Evita los Objetos"),t("p",{class:"subtitle"}," Mu√©vete con las flechas del teclado, evita los objetos rojos y recoge las monedas doradas ")],-1)),t("div",H,[t("div",V,[i[1]||(i[1]=t("label",{for:"playerName"},"Nombre del Jugador",-1)),I(t("input",{id:"playerName","onUpdate:modelValue":i[0]||(i[0]=g=>s.value=g),type:"text",placeholder:"Ingresa tu nombre",maxlength:"20",onKeyup:x(n,["enter"])},null,544),[[q,s.value]])]),t("button",{disabled:!s.value.trim(),onClick:n,class:"start-button"}," Comenzar Juego ",8,X)]),i[4]||(i[4]=t("div",{class:"instructions"},[t("h3",null,"C√≥mo Jugar"),t("ul",null,[t("li",null,"üèÉ‚Äç‚ôÇÔ∏è Usa las flechas ‚Üê ‚Üí para moverte"),t("li",null,"‚ùå Evita los objetos rojos (Game Over)"),t("li",null,"ü™ô Recoge las monedas doradas (+10 puntos)"),t("li",null,"‚è±Ô∏è Sobrevive el mayor tiempo posible (+1 punto/segundo)"),t("li",null,"üöÄ La velocidad aumenta con el tiempo")])],-1)),a.value.length>0?(v(),f("div",Y,[i[2]||(i[2]=t("h3",null,"üèÜ Mejores Puntuaciones",-1)),t("div",Q,[(v(!0),f(D,null,$(a.value,(g,c)=>(v(),f("div",{key:g.id,class:M(["score-item",{"top-score":c===0}])},[t("span",Z,"#"+m(c+1),1),t("span",ee,m(g.playerName),1),t("span",se,m(g.score)+" pts",1),t("span",te,m(g.time)+"s",1)],2))),128))])])):P("",!0)])]))}}),E=(u,o)=>{const e=u.__vccOpts||u;for(const[s,a]of o)e[s]=a;return e},oe=E(ae,[["__scopeId","data-v-b2dc3a3d"]]),ne={class:"game-hud"},re={class:"hud-container"},ie={class:"stat-group"},le={class:"stat-item"},ce={class:"stat-value score"},de={class:"stat-item"},ue={class:"stat-value time"},me={class:"stat-item"},pe={class:"stat-value player"},he={class:"controls"},ge={key:0,class:"pause-overlay"},ve=G({__name:"GameHUD",props:{score:{},time:{},playerName:{},isPaused:{type:Boolean}},emits:["togglePause","quitGame"],setup(u,{emit:o}){const e=o,s=()=>{e("togglePause")},a=n=>{const r=Math.floor(n/60),p=n%60;return`${r}:${p.toString().padStart(2,"0")}`};return(n,r)=>(v(),f("div",ne,[t("div",re,[t("div",ie,[t("div",le,[r[1]||(r[1]=t("span",{class:"stat-label"},"Puntuaci√≥n",-1)),t("span",ce,m(n.score),1)]),t("div",de,[r[2]||(r[2]=t("span",{class:"stat-label"},"Tiempo",-1)),t("span",ue,m(a(n.time)),1)]),t("div",me,[r[3]||(r[3]=t("span",{class:"stat-label"},"Jugador",-1)),t("span",pe,m(n.playerName),1)])]),t("div",he,[t("button",{onClick:s,class:"control-button"},m(n.isPaused?"‚ñ∂Ô∏è":"‚è∏Ô∏è"),1),t("button",{onClick:r[0]||(r[0]=p=>n.$emit("quitGame")),class:"control-button quit"}," üö™ Salir ")])]),n.isPaused?(v(),f("div",ge,r[4]||(r[4]=[t("div",{class:"pause-content"},[t("h2",null,"‚è∏Ô∏è Juego Pausado"),t("p",null,"Presiona el bot√≥n de play para continuar")],-1)]))):P("",!0)]))}}),ye=E(ve,[["__scopeId","data-v-0f8722c1"]]),fe={class:"game-over-screen"},Se={class:"container"},_e={class:"game-over-header"},be={class:"final-stats"},Te={class:"stat-card"},Ge={class:"stat-number"},Ee={class:"stat-card"},Oe={class:"stat-number"},we={class:"performance-analysis"},Pe={class:"analysis-stats"},Ne={class:"analysis-item"},Ce={class:"analysis-value"},ke={class:"analysis-item"},De={class:"analysis-value"},$e={class:"analysis-item"},Me={class:"analysis-value"},Ae={class:"leaderboard-section"},Be={class:"scores-container"},je={class:"position"},Ue={class:"player-info"},Ie={class:"player-name"},qe={class:"score-date"},xe={class:"score-points"},Le={class:"score-time"},Re={class:"action-buttons"},Je=G({__name:"GameOverScreen",props:{finalScore:{},finalTime:{},playerName:{}},setup(u){const o=u,e=y([]),s=y(null),a=L(()=>Math.max(0,Math.floor((o.finalScore-o.finalTime)/10))),n=async()=>{try{const c={playerName:o.playerName,score:o.finalScore,time:o.finalTime,date:new Date};s.value=await O.saveScore(c),await r()}catch(c){console.error("Error saving score:",c)}},r=async()=>{try{e.value=await O.getTopScores(10)}catch(c){console.error("Error loading scores:",c)}},p=c=>c.id===s.value,i=c=>{const d=Math.floor(c/60),h=c%60;return`${d}:${h.toString().padStart(2,"0")}`},g=c=>new Date(c).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});return w(()=>{n()}),(c,d)=>(v(),f("div",fe,[t("div",Se,[t("div",_e,[d[3]||(d[3]=t("h1",{class:"title"},"üí• Game Over",-1)),t("div",be,[t("div",Te,[t("span",Ge,m(c.finalScore),1),d[1]||(d[1]=t("span",{class:"stat-label"},"Puntuaci√≥n Final",-1))]),t("div",Ee,[t("span",Oe,m(i(c.finalTime)),1),d[2]||(d[2]=t("span",{class:"stat-label"},"Tiempo Sobrevivido",-1))])])]),t("div",we,[d[7]||(d[7]=t("h3",null,"üìä Tu Rendimiento",-1)),t("div",Pe,[t("div",Ne,[d[4]||(d[4]=t("span",{class:"analysis-label"},"Puntos por tiempo:",-1)),t("span",Ce,m(c.finalTime)+" pts",1)]),t("div",ke,[d[5]||(d[5]=t("span",{class:"analysis-label"},"Monedas recolectadas:",-1)),t("span",De,m(a.value)+" monedas",1)]),t("div",$e,[d[6]||(d[6]=t("span",{class:"analysis-label"},"Puntos por monedas:",-1)),t("span",Me,m(a.value*10)+" pts",1)])])]),t("div",Ae,[d[8]||(d[8]=t("h3",null,"üèÜ Tabla de Puntuaciones",-1)),t("div",Be,[(v(!0),f(D,null,$(e.value,(h,T)=>(v(),f("div",{key:h.id||T,class:M(["score-row",{"current-score":p(h),"top-score":T===0}])},[t("span",je,"#"+m(T+1),1),t("div",Ue,[t("span",Ie,m(h.playerName),1),t("span",qe,m(g(h.date)),1)]),t("span",xe,m(h.score),1),t("span",Le,m(i(h.time)),1)],2))),128))])]),t("div",Re,[t("button",{onClick:d[0]||(d[0]=h=>c.$emit("backToMenu")),class:"action-button secondary"}," üè† Men√∫ Principal ")])])]))}}),ze=E(Je,[["__scopeId","data-v-64ff2f3a"]]);class Fe extends S.Scene{constructor(){super({key:"GameScene"});l(this,"player");l(this,"objects",[]);l(this,"coins",[]);l(this,"cursors");l(this,"gameTimer");l(this,"score",0);l(this,"timeElapsed",0);l(this,"gameSpeed",1);l(this,"isGameOver",!1);l(this,"PLAYER_SPEED",300);l(this,"OBJECT_SPAWN_RATE",.008);l(this,"COIN_SPAWN_RATE",.005);l(this,"MIN_OBJECT_SPEED",100);l(this,"MAX_OBJECT_SPEED",400);l(this,"onScoreUpdate");l(this,"onTimeUpdate");l(this,"onGameOver")}create(){console.log("GameScene created"),this.player=this.add.rectangle(this.scale.width/2,this.scale.height-50,40,40,3900150),this.player.setStrokeStyle(2,16777215),this.cursors=this.input.keyboard.createCursorKeys();const e=this.input.keyboard.addKeys("W,S,A,D");Object.assign(this.cursors,e),this.gameTimer=this.time.addEvent({delay:1e3,callback:this.updateTimer,callbackScope:this,loop:!0}),this.score=0,this.timeElapsed=0,this.gameSpeed=1,this.isGameOver=!1,console.log("Game initialized with callbacks:",{onScoreUpdate:!!this.onScoreUpdate,onTimeUpdate:!!this.onTimeUpdate,onGameOver:!!this.onGameOver})}update(){this.isGameOver||(this.handlePlayerMovement(),this.spawnObjects(),this.updateObjects(),this.updateCoins(),this.checkCollisions(),this.updateDifficulty())}handlePlayerMovement(){const e=this.PLAYER_SPEED,s=this.game.loop.delta/1e3;this.cursors.left.isDown&&(this.player.x=Math.max(20,this.player.x-e*s)),this.cursors.right.isDown&&(this.player.x=Math.min(this.scale.width-20,this.player.x+e*s))}spawnObjects(){if(Math.random()<this.OBJECT_SPAWN_RATE*this.gameSpeed){const e=S.Math.Between(20,this.scale.width-20),s=S.Math.Between(this.MIN_OBJECT_SPEED*this.gameSpeed,this.MAX_OBJECT_SPEED*this.gameSpeed),a=this.add.rectangle(e,-20,30,30,15680580);a.setStrokeStyle(2,16711680),a.setData("speed",s),this.objects.push(a)}if(Math.random()<this.COIN_SPAWN_RATE*this.gameSpeed){const e=S.Math.Between(20,this.scale.width-20),s=S.Math.Between(80,200)*this.gameSpeed,a=this.add.rectangle(e,-20,20,20,16096779);a.setStrokeStyle(2,16776960),a.setData("speed",s),this.coins.push(a)}}updateObjects(){const e=this.game.loop.delta/1e3;this.objects=this.objects.filter(s=>{const a=s.getData("speed");return s.y+=a*e,s.y>this.scale.height+50?(s.destroy(),!1):!0})}updateCoins(){const e=this.game.loop.delta/1e3;this.coins=this.coins.filter(s=>{const a=s.getData("speed");return s.y+=a*e,s.y>this.scale.height+50?(s.destroy(),!1):!0})}checkCollisions(){for(const e of this.objects)if(this.checkCollision(this.player,e)){console.log("Collision detected! Game Over"),this.gameOver();return}this.coins=this.coins.filter(e=>{var s;return this.checkCollision(this.player,e)?(this.score+=10,console.log("Coin collected! New score:",this.score),(s=this.onScoreUpdate)==null||s.call(this,this.score),this.createCoinEffect(e.x,e.y),e.destroy(),!1):!0})}checkCollision(e,s){const a=e.getBounds(),n=s.getBounds();return S.Geom.Rectangle.Overlaps(a,n)}createCoinEffect(e,s){const a=this.add.text(e,s,"+10",{fontSize:"20px",color:"#F59E0B",fontStyle:"bold"});this.tweens.add({targets:a,y:s-50,alpha:0,duration:800,ease:"Power2",onComplete:()=>a.destroy()})}updateTimer(){var e,s;this.isGameOver||(this.timeElapsed+=1,console.log("Timer updated:",this.timeElapsed),(e=this.onTimeUpdate)==null||e.call(this,this.timeElapsed),this.score+=1,console.log("Score updated by time:",this.score),(s=this.onScoreUpdate)==null||s.call(this,this.score))}updateDifficulty(){this.gameSpeed=1+this.timeElapsed/30*.3}gameOver(){var e;console.log("Game Over called"),this.isGameOver=!0,this.gameTimer&&this.gameTimer.destroy(),console.log("Calling onGameOver callback"),(e=this.onGameOver)==null||e.call(this)}resetGame(){var e,s;console.log("Resetting game"),this.objects.forEach(a=>a.destroy()),this.coins.forEach(a=>a.destroy()),this.objects=[],this.coins=[],this.score=0,this.timeElapsed=0,this.gameSpeed=1,this.isGameOver=!1,this.player.x=this.scale.width/2,this.player.y=this.scale.height-50,this.gameTimer&&this.gameTimer.destroy(),this.gameTimer=this.time.addEvent({delay:1e3,callback:this.updateTimer,callbackScope:this,loop:!0}),(e=this.onScoreUpdate)==null||e.call(this,this.score),(s=this.onTimeUpdate)==null||s.call(this,this.timeElapsed)}pauseGame(){this.scene.pause()}resumeGame(){this.scene.resume()}}class Ke{constructor(){l(this,"game",null);l(this,"gameScene",null);l(this,"onScoreUpdate");l(this,"onTimeUpdate");l(this,"onGameOver")}initializeGame(o){this.game&&this.game.destroy(!0);const e={type:S.AUTO,width:800,height:600,parent:o,backgroundColor:"#0f172a",scene:Fe,physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scale:{mode:S.Scale.FIT,autoCenter:S.Scale.CENTER_BOTH,width:800,height:600}};this.game=new S.Game(e),this.game.events.once("ready",()=>{this.gameScene=this.game.scene.getScene("GameScene"),this.gameScene.onScoreUpdate=s=>{var a;console.log("Score callback triggered:",s),(a=this.onScoreUpdate)==null||a.call(this,s)},this.gameScene.onTimeUpdate=s=>{var a;console.log("Time callback triggered:",s),(a=this.onTimeUpdate)==null||a.call(this,s)},this.gameScene.onGameOver=()=>{var s;console.log("Game over callback triggered"),(s=this.onGameOver)==null||s.call(this)},console.log("GameManager initialized with callbacks")})}startGame(){console.log("Starting game"),this.gameScene&&this.gameScene.resetGame()}pauseGame(){this.gameScene&&this.gameScene.pauseGame()}resumeGame(){this.gameScene&&this.gameScene.resumeGame()}getCurrentScore(){var o;return((o=this.gameScene)==null?void 0:o.score)||0}getCurrentTime(){var o;return Math.floor(((o=this.gameScene)==null?void 0:o.timeElapsed)||0)}isGameOver(){var o;return((o=this.gameScene)==null?void 0:o.isGameOver)||!1}destroy(){this.game&&(this.game.destroy(!0),this.game=null,this.gameScene=null)}}const We={class:"app"},He={key:1,class:"game-container"},Ve=G({__name:"App",setup(u){const o=y("start"),e=new Ke,s=y(""),a=y(0),n=y(0),r=y(0),p=y(0),i=y(!1),g=_=>{s.value=_,o.value="playing",setTimeout(()=>{c()},100)},c=()=>{const _=document.getElementById("game-canvas");_&&(console.log("Initializing game with player:",s.value),e.onScoreUpdate=b=>{console.log("App received score update:",b),a.value=b},e.onTimeUpdate=b=>{console.log("App received time update:",b),n.value=b},e.onGameOver=()=>{console.log("App received game over"),r.value=e.getCurrentScore(),p.value=e.getCurrentTime(),console.log("Final stats:",{score:r.value,time:p.value}),o.value="gameOver"},e.initializeGame(_),setTimeout(()=>{e.startGame(),a.value=0,n.value=0,i.value=!1},500))},d=()=>{i.value=!i.value,i.value?e.pauseGame():e.resumeGame()},h=()=>{confirm("¬øEst√°s seguro de que quieres salir del juego?")&&(e.destroy(),o.value="start",N())},T=()=>{o.value="playing",setTimeout(()=>{e.startGame(),a.value=0,n.value=0,i.value=!1},100)},B=()=>{e.destroy(),o.value="start",N()},N=()=>{s.value="",a.value=0,n.value=0,r.value=0,p.value=0,i.value=!1},C=_=>{o.value==="playing"&&(_.code==="Space"||_.code==="Escape")&&(_.preventDefault(),d())};return w(()=>{document.addEventListener("keydown",C)}),R(()=>{document.removeEventListener("keydown",C),e.destroy()}),(_,b)=>(v(),f("div",We,[o.value==="start"?(v(),k(oe,{key:0,onStartGame:g})):o.value==="playing"?(v(),f("div",He,[J(ye,{score:a.value,time:n.value,"player-name":s.value,"is-paused":i.value,onTogglePause:d,onQuitGame:h},null,8,["score","time","player-name","is-paused"]),b[0]||(b[0]=t("div",{id:"game-canvas",class:"game-canvas"},null,-1))])):o.value==="gameOver"?(v(),k(ze,{key:2,"final-score":r.value,"final-time":p.value,"player-name":s.value,onPlayAgain:T,onBackToMenu:B},null,8,["final-score","final-time","player-name"])):P("",!0)]))}}),Xe=E(Ve,[["__scopeId","data-v-90d1e77a"]]),A=z(Xe);A.config.errorHandler=(u,o)=>{console.error("Error global capturado:",u,o)};A.mount("#app");setTimeout(()=>{const u=document.querySelector(".loading");u&&u.remove()},1e3);
